<head>
    <script language="javascript" src="p5.js"></script>
    <script language="javascript" src="../build/ijeomamotion.js"></script>
    <script type="text/javascript">
    // var angles = [30, 10];
    var x, y, size;
    var angles = [30, 10, 45, 35, 60, 38, 75, 67];
    var rotation = 270;
    var pieArcs = [];

    function setup() {
        createCanvas(windowWidth, windowHeight);
        noStroke();
        angleMode(DEGREES);

        x = width / 2;
        y = height / 2;
        size = height - height / 3;

        var offset = height / 2;
        var lastAngle = 0;

        for (var i = 0; i < angles.length; i++) {
            var gray = (i < 0) ? 255 : map(i, 0, angles.length, 0, 255);
            pieArcs.push(new PieArc(i, 0, 0, offset, size, angles[i], lastAngle, gray, 0));
            lastAngle += angles[i];
        }

        s = new MOTION.Sequence();

        var a = rotation;
        var d = .25;

        for (var i = 0; i < pieArcs.length; i++) {
            var pa = pieArcs[i]
            a -= (i > 0) ? (angles[i - 1] / 2 + angles[i] / 2) : angles[i] / 2;

            s.add(new MOTION.Tween(this, 'rotation', a, d).easing(Expo.In).relative());
            s.add(new MOTION.Tween(pa, d).add('offset', 0).add('alpha', 255).easing(Circ.Out));
            s.add(new MOTION(d));
        }

        s.add(new MOTION.Tween(this, 'y', height, d / 2).easing(Circ.In));

        s.repeat().play();
    }

    function draw() {
        background(100);

        s.update();

        push();
        translate(x, y)
        for (var i = 0; i < pieArcs.length; i++)
            pieArcs[i].draw();
        pop();

        fill(255);
        text('Drag left to right to scrub.', 25, 25);
    }

    function mousePressed() {
        s.pause();
    }

    function mouseReleased() {
        s.resume();
    }

    function mouseDragged() {
        s.seek(mouseX / width)
    }

    function keyTyped() {
        if (key == 'a')
            s.pause();
        else if (key == 's')
            s.resume();
        else if (key == 'd')
            s.play();
        else if (key == 'f')
            s.stop();
    }
    PieArc = function(id, x, y, offset, d, a1, a2, c, a) {
        this.id = id;
        this.x = x;
        this.y = y;
        this.offset = offset;
        this.d = d;
        this.a1 = a1;
        this.a2 = a2;
        this.color = c;
        this.alpha = a;
        this.draw = function() {
            // stroke(255,this.alpha);
            // fill(0,this.alpha) 
            noStroke()
            fill(this.color, this.alpha)
            push();
            translate(this.x, this.y)
            rotate(rotation + this.a2)
            translate(this.offset * cos(this.a1 / 2), this.offset * sin(this.a1 / 2))
            arc(0, 0, this.d, this.d, 0, (this.a1), PIE);
            pop();
        };
        return this;
    }
    </script>
    <style>
    body {
        padding: 0;
        margin: 0;
    }
    </style>
</head>

<body>
</body>